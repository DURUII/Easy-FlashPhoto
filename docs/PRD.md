# Image-Glitch MVP

通电风照片：当照片里的元素依次被点亮，就像被接通了电极。
@flashphoto @infp @ig @照片通电 @照片闪烁 @imageglitch

## 1. 产品概述

### 1.1 产品定位

一款基于 Web 的故障艺术视频生成工具，让用户无需专业剪辑软件，即可 DIY 将静态照片转化为随音乐节拍闪烁的动态视频。

### 1.2 目标用户
- Instagram/TikTok/小红书等平台的内容创作者
- 想制作炫酷视频效果发朋友圈但觉得抠图过于麻烦且不会使用专业剪辑软件
- 喜欢故障艺术风格

### 1.3 核心价值
- 简化操作：将需要专业剪辑软件才能完成的效果，简化为"上传图片→选择音乐→导出"三步
- 智能化：自动识别图片主体、通过点击选择主体
- 即时预览：实时预览效果，所见即所得
- 高可玩性：支持多种输出格式和灵活的特效参数调节

## 2. 功能需求

### 2.1 图片导入模块
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 本地上传 | 支持上传图片，拖拽或点击 | P0 |
| 示例图片 | 提供 2-3 个内置示例快速体验 | P1 |
| 图片预览 | 上传后显示原图，支持缩放/平移 | P0 |
| 格式支持 | JPG, PNG, WEBP | P0 |

### 2.2 主体分割模块
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 正向选择 | 左键点击添加正向提示点，选择主体 | P0 |
| 负向排除 | 右键点击添加负向提示点，排除区域 | P0 |
| 实时预览 | 点击后实时显示分割掩码效果 | P0 |
| 多主体选择 | 支持选择多个独立主体 | P0 |
| 主体编号 | 选择的主体自动按点击顺序编号 (1,2,3...) | P0 |
| 顺序拖拽 | 在主体栏中拖拽调整通电顺序 | P1 |
| 主体栏 | 显示所有已选主体，不同颜色区分，带白色边框流淌动画 | P1 |
| 清除操作 | 支持清除单个/全部已选主体 | P0 |

**技术实现**：
- 基于 Segment Anything Model (SAM) 的图像分割
- Web Worker 异步处理，不阻塞 UI
- 使用 slimsam-77-uniform 量化模型

### 2.3 音频模块
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 内置 BGM | MVP 版本内置 2 套节奏 BGM | P0 |
| BGM 预览 | 切换 BGM 时可预览效果 | P1 |
| 节拍分析 | 本地节拍分析器（默认关闭，MVP 预定义节拍点） | P2 |
| 音频导出 | 导出的视频包含 BGM 音轨 | P0 |

### 2.4 动画编排模块
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 顺序预览 | 显示主体通电点亮顺序（视觉指示器） | P0 |
| 渐变曲线 | 调节亮度变化的曲线（线性/平滑/阶跃） | P0 |
| 闪烁强度 | 调节亮度从暗到亮的幅度 | P1 |
| 实时播放 | 预览整个动画效果 | P0 |
| 固定时长 | MVP 采用固定视频时长（3-5秒） | P0 |

**通电效果（可扩展接口）**：
```
当前 MVP：亮度渐变（基础版）
扩展方向：轮廓通电、内部闪烁、颜色故障、信号干扰等
```

### 2.5 导出模块
| 功能 | 描述 | 优先级 |
|------|------|--------|
| Live Photo | 导出 iPhone 可用的 .mov 格式 | P0 |
| MP4 视频 | 导出标准视频格式 | P0 |
| GIF 动图 | 导出 GIF 格式 | P0 |
| 分辨率调节 | 支持不同分辨率导出 | P1 |
| 导出预览 | 导出前显示最终效果预览 | P1 |

## 3. 用户旅程地图

| 阶段 | 用户目标 | 关键动作 | 情绪状态 |
|------|----------|----------|----------|
| 导入 | 上传照片 | 点击上传/选择示例图片 | 期待、快速验证 |
| 分割 | 选中主体区域 | 左键选/右键排 → 预览 → 拖拽排序 | 控制感、创作欲 |
| 音频 | 匹配音乐节奏 | 从 2 套内置 BGM 中选择 | 沉浸感 |
| 编排 | 设置通电顺序与闪烁效果 | 调整顺序 → 选择渐变曲线 → 预览 | 创作乐趣 |
| 预览与导出 | 验证最终效果，分享到社交平台 | 实时播放 → 导出 Live Photo/MP4/GIF | 满足、成就感 |

## 4. 交互设计

### 4.1 主流程（分割优先）

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  1. 上传图片 │ -> │ 2. 选择主体 │ -> │  3. 选 BGM  │ -> │ 4. 预览导出 │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      ↓                  ↓                  ↓                  ↓
   拖拽/点击        左键选/右键排         2 套内置           实时播放+
      ↓               拖拽排序             BGM              3 种格式
```

### 4.2 主体选择交互

1. **初始状态**：图片全亮
2. **左键点击**：添加正向点 → 主体高亮显示 → 编号 ①
3. **右键点击**：添加负向点 → 排除该区域
4. **继续点击**：添加更多主体 → 自动编号 ②③④...
5. **拖拽调整**：在底部主体栏拖拽改变顺序

### 4.3 主体栏设计

```
┌─────────────────────────────────────────────────────┐
│  ① 🐱    ② 🐕    ③ 🌳    ④ 🏠    ⑤ 🚗          │
│  [颜色A]  [颜色B]  [颜色C]  [颜色D]  [颜色E]       │
│                    ↑                               │
│            白色边框流淌动画指示当前主体              │
└─────────────────────────────────────────────────────┘
```

## 5. 技术架构

### 5.1 前端技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 框架 | Vanilla JS / Web Components | 轻量级，无构建依赖 |
| 分割模型 | Transformers.js + SAM | WebAssembly 加速 |
| 视频导出 | FFmpeg.wasm | 浏览器端视频编码 |
| 样式 | CSS3 + Flexbox/Grid | 响应式设计 |

### 5.2 模块划分

```
┌─────────────────────────────────────────────────────┐
│                    index.html                       │
├─────────────────────────────────────────────────────┤
│                      index.js                        │
│  ┌───────────┐ ┌───────────┐ ┌───────────────────┐  │
│  │ ImageUploader │ │ Segmentor │ │ AnimationPlayer │  │
│  │   (图片上传)  │ │  (分割)   │ │   (动画播放)    │  │
│  └───────────┘ └───────────┘ └───────────────────┘  │
├─────────────────────────────────────────────────────┤
│                    worker.js                         │
│  ┌───────────────────────────────────────────────┐  │
│  │           SAM Model Inference                 │  │
│  │  (SegmentationAnythingSingleton)              │  │
│  └───────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────┤
│                   audio/ (内置 BGM)                   │
├─────────────────────────────────────────────────────┤
│                  export/ (FFmpeg.wasm)              │
└─────────────────────────────────────────────────────┘
```

### 5.3 性能优化

| 优化项 | 策略 |
|--------|------|
| 模型加载 | 首次访问预加载，Service Worker 缓存 |
| 分割推理 | Web Worker 异步处理，实时反馈 |
| 动画渲染 | Canvas 2D / WebGL 硬件加速 |
| 首屏优化 | 骨架屏 + 渐进式加载 |

## 6. MVP 里程碑

### Phase 1: 核心分割（当前）
- [x] 图片上传与预览
- [x] SAM 模型集成
- [x] 正/负向点选择
- [x] 实时掩码预览
- [x] 图片导出

### Phase 2: MVP 发布
- [ ] 多主体选择与编号
- [ ] 主体栏拖拽排序
- [ ] 2 套内置 BGM
- [ ] 渐变曲线调节
- [ ] 固定时长导出
- [ ] 3 种格式导出（Live Photo/MP4/GIF）

### Phase 3: 增强体验
- [ ] 节拍分析器
- [ ] 更多 BGM
- [ ] 特效插件接口
- [ ] 导出分辨率调节
- [ ] 社交分享集成

## 7. 成功指标

| 指标 | 目标值 |
|------|--------|
| 首次分割响应时间 | < 2s |
| 页面加载完成时间 | < 3s |
| 主体选择准确率 | > 90% |
| 视频导出成功率 | > 95% |
| 用户完成率 | > 60% |

## 8. 风险与对策

| 风险 | 影响 | 对策 |
|------|------|------|
| 模型体积大 | 首次加载慢 | 量化模型 + 预加载 + 离线缓存 |
| 移动端性能 | 分割卡顿 | Web Worker 隔离 + 渐进式降级 |
| 浏览器兼容性 | 功能不可用 | Chrome/Safari/Firefox 主流支持 |
| 导出文件过大 | 分享困难 | 多分辨率选项 + 压缩算法 |

## 9. 附录

### 9.1 术语表

| 术语 | 定义 |
|------|------|
| 通电风 | 照片元素依次点亮的效果，模拟电流传导 |
| SAM | Segment Anything Model，Meta 发布的图像分割模型 |
| 节拍点 | 音乐中节奏强拍的位置 |
| 渐变曲线 | 亮度变化的平滑程度（线性/平滑/阶跃） |

### 9.2 参考竞品
- Flashphoto.app
- Pika Labs
- Runway ML